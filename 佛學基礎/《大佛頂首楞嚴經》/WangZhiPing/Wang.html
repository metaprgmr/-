<html>
<head>
<meta charset="utf-8">
<title>王治平居士《楞嚴經譯解》</title>
<style>
a { text-decoration:none }
.title { color:#FF6600; font-widht:bold; font-size:17.0pt; }
.verse { color:teal; font-weight:bold }
.label { color:purple }
.jielabel { background-color:purple; color:white }
.jietext { background-color:#f0f0ff }
.hy { color:lightgray }
</style>
<script src="../../../util/reading.js"></script>
<script src="verses.js"></script>
<script src="verses-xrefs.js"></script>
<script>
function toZNum(i) { return (i === 10) ? '十' : zNumber(i) }
function ensureInt(x, defVal) { return (!x || (x == '') || isNaN(x)) ? defVal : ((typeof x === 'string') ? parseInt(x) : x) }

// volNum 0 based
function selectVol(volNum, verseNum) {
  volNum = ensureInt(volNum, 0);
  if (sessionStorage.volNum != volNum) { sessionStorage.volNum = volNum; sessionStorage.wangVerseNum = null; }
  var cnt = 0, buf = new Buffer('<h3>卷&nbsp;');
  for (var i=0; i<10; ++i) {　
    var ziCnt = verses[i].length;
    if (i > 0) buf.w('&nbsp;&nbsp;');
    if (i == volNum)
      buf.w('<font style="color:red; background-color:yellow" title="', ziCnt, '段">', toZNum(i+1), '</font>');
    else
      buf.w('<a href="?vid=', i, '" title="', ziCnt, '段">', toZNum(i+1), '</a>');
    console.log('第' + toZNum(i+1) + '卷：' + verses[i].length + '段。');
    cnt += ziCnt;
  }
  console.log('總　共：' + cnt + '段。');
  buf.w('&nbsp;&nbsp;&nbsp;&nbsp;<a href="WangVerses.html">純經文</a></h3>');
  buf.render('volumeNums1', 'volumeNums2');

  showText(volNum, verseNum);
}

// volNum 0 based
function showText(volNum, verseNum) {
  var isAll = verseNum === 'all';
  var numVerses = isAll ? 1000 : 10;
  if (!verseNum) verseNum = sessionStorage.wangVerseNum;
  verseNum = ensureInt(verseNum, 1);
  sessionStorage.wangVerseNum = verseNum;
  var buf = new Buffer();
  buf.w('<table border=0 cellspacing=0>');
  var vol = verses[volNum];
  var verseNum = 1;
  for (var i=0; i<vol.length; ++i) {
    var j, k, ln = vol[i], hy = w2hyDisp(volNum+1, verseNum);
    if (hy) hy = '<br><font class=hy>' + hy + '</font>';
    buf.w('<tr>');
    if (typeof ln === 'string') {
      buf.w('<td colspan=3 style="border-top:1px solid #fbbbbb"></td><td valign=top style="border-top:1px solid gray">', ln, '</td></tr>');
    } else {
      // first row
      var rows = ln.components.length;
      var rowspan = (rows > 1) ? (' rowspan='+rows) : '';
      if (ln.type === '正文') {
        buf.w('<td nowrap align=right valign=top class=label', rowspan, ' style="padding-top:4px; padding-right:5px">', digit3RightAligned(verseNum++), hy, '</td>'); // 【】
      } else {
        buf.w('<td', rowspan, ' style="border-top:0px solid #fbbbbb"></td>');
      }
      buf.w('<td width="400px" valign=top', rowspan, ' style="border-top:0px solid #fbbbbb; padding-right:20px">',
            '<span class="', (ln.type === '經名') ? 'title' : 'verse', '">', ln.text, '</span></td>');

      if (rows === 0)
        buf.w('<td colspan=3 style="border-top:1px solid #fbbbbb"></td></tr>');
      else {
        var c = ln.components[0];
        var cls = c.type == '解' ? ' class=jielabel' : ' class=label';
        buf.w('<td nowrap align=right valign=top style="border-top:1px solid #fbbbbb; padding-right:5px"><span', cls, '>', c.type, '</span></td>');
        buf.w('<td valign=top', c.type == '解' ? ' class=jietext' : '', ' style="border-top:1px solid #fbbbbb">');
        if (!c.content)
          ;
        else if (c.content.length === 1)
          buf.w(c.content[0], '</td></tr>');
        else {
          for (j=0; j<c.content.length; ++j)
            buf.w('<p>', c.content[j], '</p>');
          buf.w('</td></tr>');
        }

        // following rows
        for (j=1; j<ln.components.length; ++j) {
          c = ln.components[j];
          cls = c.type == '解' ? 'jielabel' : 'label';
          buf.w('<tr>',
                '<td nowrap align=right valign=top style="padding-right:5px"><span class=', cls, '>', c.type, '</span></td>');
          buf.w('<td valign=top', c.type == '解' ? ' class=jietext' : '', '>');
          if (!c.content)
            ;
          else if (c.content.length === 1)
            buf.w(c.content[0], '</td></tr>');
          else
            for (k=0; k<c.content.length; ++k)
              buf.w('<p>', c.content[k], '</p>');
          buf.w('</td></tr>');
        }
      }
    }
  }
  buf.w('</table>');
  buf.render('verseStage');
}
</script>
</head>
<body><center>

<h2 title="虽然虛雲老和尚說不必看註解，奈何根性漏劣，且不到出家的福分。還是看看譯解，聊勝於徹底茫然。"
>楞嚴經譯解<br><font style="font-size:18px">王治平居士</font></h2>

<table border="0" width="95%">
<tr><td align="center" id="volumeNums1"></td></tr>
<tr><td style="border-bottom:1px solid black" id="verseStage"></td></tr>
<tr><td align="center" id="volumeNums2"></td></tr>
</table>
<script>
  selectVol(get('vid') || 0);
</script>
</center></body></html>

